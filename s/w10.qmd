---
title: "Introduction to network analysis"
author: "Pablo Gomez"
format: 
  revealjs:
    theme: [dark, custom.scss]
    footer: ""
    pdf-separate-fragments: true
editor: source
title-slide-attributes:
    data-background-image: img/bg_title.png
---

To see this slides online go to: [https://cadms.github.io/mpm207/s/w3.html](https://cadms.github.io/mpm207/s/w10.html)

# Network analysis{background-image="img/bg_title.png"}

## [Why represent events in a network?]{.r-fit-text}{background-image="img/bg.png"}
<br/>

:::: columns
::: {.column .fragment .fade-in fragment-index=0}
[Identify individuals that are very active]{.black}
![](img/w10/sna_01.png){fig-align="center"}
:::

::: {.column .fragment .fade-in fragment-index=1}
[Identify individuals that are intermediate]{.black}
![](img/w10/sna_02.png){fig-align="center"}
:::

::::


## What is a graph?{background-image="img/bg.png"}
<br/>

![](img/w10/sna_graphs.png){fig-align="center"}

## Elements of a network{background-image="img/bg.png"}
<br/>

[Nodes (vertices)]{.black}

![](img/w10/sna_nodes.png){fig-align="center"}

[$$V = [1, 2, 3, ..., i]$$]{.black}


## Elements of a network{background-image="img/bg.png"}
<br/>

[Nodes (vertices)]{.black}

![](img/w10/sna_nodesFaces.png){fig-align="center"}

[$$V = [1, 2, 3, ..., i]$$]{.black}

## Elements of a network{background-image="img/bg.png"}
<br/>

[Edges (links)]{.black}

![](img/w10/sna_edges.png){fig-align="center"}

[$$E = [(1, 2), (1, 3), (2, 3), ..., (i,j)]$$]{.black}

## Elements of a network{background-image="img/bg.png"}
<br/>

[Network attributes]{.black}

![](img/w10/sna_attributes.png){fig-align="center"}

[$$V = [0, 1, 1, ..., x_i]$$]{.black}

## Data structure{background-image="img/bg.png"}
<br/>

![](img/w10/sna_data.png){fig-align="center"}

## SNA in R{background-image="img/bg.png"}
</br>

  - [igraph]{.black}
  - [networks]{.black}
  - [tidygraph]{.black}
  - [sna]{.black}

## tidygraph{background-image="img/bg.png"}

```{r echo=F, warning=F, message=F}
# Libraries we will use:
library(dplyr) # for data manipulation
library(ggplot2) # For making figures
library(ggraph) # For visualization of the networks
library(igraph) # for network analysis
library(tidygraph) # tidyverse friendly network analysis

# Loading the data from the STNet package ------------
# Load the data for nodes
node <- stnet::SwinePrem # load the data from the STNet library
# Load the data for edges
edge <- stnet::SwineMov %>% 
  mutate(date = as.Date(date, "%m/%d/%y"))
```

```{r echo=T, eval=F}
node
```

```{r}
library(kableExtra)
node %>% kbl() %>% kable_paper(full_width = F, lightable_options = c('hover')) 
```

## tidygraph{background-image="img/bg.png"}

```{r echo=T, eval=F}
edge
```

```{r}
edge %>% kbl() %>% kable_paper(full_width = F, lightable_options = c('hover')) 
```


## Creating the network{background-image="img/bg.png"}

```{r create the network, echo=T}
net <- tbl_graph(
  nodes = node, # Our node table
  edges = edge # the edge table
)

net
```
## tidygraph syntax {background-image="img/bg.png"}

::: incremental
  - [remember `%>%`?]{.black}  
  - [tidygrapgh introduces two new type of operators:]{.black}
    - [`%N>%` for nodes]{.black}
    - [`%E>%` for edges]{.black}
:::


## Accesing the nodes{background-image="img/bg.png"}

```{r echo=T}
net %N>% # access the nodes with the %N>% op
  mutate(degree = centrality_degree()) # compute degree
```

## Accesing the edges{background-image="img/bg.png"}

```{r echo=T}
net %E>% # access the edges with the %E>% op
  mutate(date_year = format(date, "%Y")) # compute degree
```


## General properties{background-image="img/bg.png"}
<br/>

![](img/w10/sna_generalProperties.png){fig-align="center"}

## General properties{background-image="img/bg.png"}
<br/>
  
  - [Size]{.black}
  - [Diameter]{.black}
  - [Average path length]{.black}
  - [Density]{.black}
  - [Fragmentation]{.black}
  - [Clustering Coefficient]{.black}

## General properties{background-image="img/bg.png"}
<br/>

![](img/w10/sna_generalAttr-1.png){fig-align="center"}

## General properties{background-image="img/bg.png"}
<br/>

![](img/w10/sna_generalAttr-2.png){fig-align="center"}


## Local properties{background-image="img/bg.png"}
<br/>

![](img/w10/sna_localProperties.png){fig-align="center"}

## Local properties{background-image="img/bg.png"}
<br/>

![](img/w10/sna_centrality-1.png){fig-align="center"}

## Local properties{background-image="img/bg.png"}
<br/>

![](img/w10/sna_centrality-2.png){fig-align="center"}

## Other centrality measures {background-image="img/bg.png"}
</br>

![](img/w10/centrality.png){fig-align="center"}


## Visualization{background-image="img/bg.png"}
<br/>

```{r, echo=T}
ggraph(net, layout = 'kk') + # this is our empty canvas
  geom_edge_link(aes(width = pigs.moved)) + # Add the edges
  geom_node_point() + # Add the nodes
  scale_edge_width(range = c(0.01, 0.9)) + # we set the range for the width of the edges
  labs(title = 'Title for the plot', edge_width = 'Number of pigs moved') # labels for the figure
```

# [It's Lab time!](http://cadms.github.io/mpm207/lab10.html)
Network analysis in R

