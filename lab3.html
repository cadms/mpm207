<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Lab 3 - Data handling, validation and manipulation in R</title>

<script src="site_libs/header-attrs-2.25/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"><img id="logo" style="width: 30px;" src="img/cadms-logo.png" /></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Contact
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Instructors.html">
        <span class="fa fa-users"></span>
         
        Instructors
      </a>
    </li>
    <li>
      <a href="https://cadms.vetmed.ucdavis.edu">
        <span class="fa fa-server"></span>
         
        CADMS Website
      </a>
    </li>
    <li>
      <a href="mailto:jpgo@ucdavis.edu">
        <span class="fa fa-envelope"></span>
         
        Email
      </a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Lab 3 - Data handling, validation and
manipulation in R</h1>

</div>


<div id="objectives" class="section level1">
<h1>Objectives</h1>
<ul>
<li>Get started with project organization in R studio</li>
<li>Familiarize with the R studio interface and basic R syntaxt</li>
<li>Conduct advanced data handling, validation, and manipulation</li>
<li>Compute summary statistics with data</li>
<li>Introduction to visualization of data</li>
</ul>
<hr />
</div>
<div id="i-setting-up-your-environment" class="section level1">
<h1>I: Setting up your environment</h1>
</div>
<div id="the-rstudio-interface" class="section level1">
<h1>The Rstudio interface</h1>
<p>When we start R studio, we can see 4 sections:</p>
<ol style="list-style-type: decimal">
<li><strong>Source</strong> (top left), here we have our code editor and
other files. We will use this section to edit and view our scripts and
other documents we will be using to interact with R.</li>
<li><strong>Console and Terminal</strong> (bottom left), this is where
the code is executed (<em>Console</em> will execute R code and
<em>Terminal</em> other code for your operating system). We can directly
write the code here, but normally we will be using the other source
files such as .R or .Rmd to write our code which then will be send
here.<br />
</li>
<li><strong>Environment, History and others</strong> (top right),
Environment will list all the objects you create and History will have
the code you sent to the console. There are other tabs in this section
which we wont be using for now.</li>
<li><strong>Files, Packages and Help</strong> (bottom right). This
section includes a file browser, and other tabs for package management
and help.</li>
</ol>
<p><img src="img/w3/I_a.png" style="width:100%" align="center"/></p>
</div>
<div id="organizing-your-projects" class="section level1">
<h1>Organizing your projects</h1>
<p>One of the most useful features of R studio is the project
organization, if you haven, I strongly encourage you to familiarize with
creating and using projects to organize your workflow. Projects allow to
create a file that will contain all the information regarding your
session (including objects, data sets and configurations) and organize
your files in folders in your system. This is particularly useful when
we are working with multiple topics.<br />
When you open Rstudio for the first time it starts on an empty project.
To create a new project, just go to the top right corner menu and select
<em>New Project…</em></p>
<p><img src="img/w3/Ia_01-NewProj.png" style="width:50%" align="center"/></p>
<p>Then will five you the option to create a new project in a new
directory, un an existing directory or version control. For today, we
wont be talking about version control in detail, but this is to
integrate Rstudio with Github.</p>
<p><img src="img/w3/Ia_02-NewProj.png" style="width:30%" align="center"/></p>
<p>Once you have selected the option that you want, it will show you
multiple options for types of projects, you can select <em>New
project</em> and continue.</p>
<p><img src="img/w3/Ia_03-NewProj.png" style="width:30%" align="center"/></p>
<p>Then you just name your directory and select a location.</p>
<p><img src="img/w3/Ia_04-NewProj.png" style="width:30%" align="center"/></p>
<p>Once the project is created, in the files tab you will see that
Rstudio created the files for your project in the folder that you
selected. The project organization depends on your personal preferences,
but I usually like to create 3 folders (code, data and docs) to organize
my files related with the current project.</p>
<p><img src="img/w3/Ia_05-NewProj.png" style="width:30%" align="center"/></p>
<div id="intro-to-markdown" class="section level2">
<h2>Intro to Markdown</h2>
<p><img src="img/w3/Ia_Docs.png" style="float:right;width:16.0%" /></p>
<p>R studio can create several types of documents including: R scripts,
text files, Markdown, among others. To create a new document you can go
to the menu located at the upper left corner.</p>
<p>A menu will show with all the different document types you can
create. For now we will select the option <em>R Markdown…</em>.</p>
<p>It might ask you to install a library if it’s not already installed,
so just click yes if it does. This will open a window where will ask for
a title, author, date, and some options for the type of output of the
document. Add your name and select the render format to word (this can
be changed later).</p>
<p><img src="img/w3/Ia_RmdCreate.png" style="width:30%" align="center"/></p>
</div>
<div id="documents-with-r-markdown-.rmd" class="section level2">
<h2>Documents with R Markdown (.Rmd)</h2>
<p>We created our first document with R Markdown, and will look like
this:</p>
<p><img src="img/w3/Ia_RmdDoc.png" style="width:60%" align="center"/></p>
<p>The document has already the header and a code ‘chunk’ (we will talk
more about this later). Add a title for the document and put your name
in the author field. The Rmd documents use a syntax called markdown
which we will not cover in detail, but you can find more info in <a
href="https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf">this
link</a>. You can edit the document directly with the Rmd syntax, but if
you prefer to save some time and don’t have to deal with learning
everything from scratch, there is an option to edit the document in a
more familiar way. To do this just change the option located in the top
right of the document from <em>Source</em> to <em>Visual</em>. You will
notice that a toolbar with some familiar icons appeared at the top.</p>
<p><img src="img/w3/Ia_RmdVisual.png" style="width:60%" align="center"/></p>
<p>To add a new section to the document, you might want to start with a
title. The titles can be hierarchical similar to what we are used in
other text editors (Title, Subtitle 1, Subtitle 2, etc…). To define a
new title we use the character <code>#</code> in front of the text, and
the number of <code>#</code> before the text will be the hierarchy
level. For example if we want to define a title hierarchy we write:</p>
<pre><code># Title 1

## Subtitle 1

### Subtitle 2</code></pre>
<p>Which in our visual and rendered document will look like this:</p>
<p><img src="img/w3/Ia_Titles.png" style="width:40%" align="center"/></p>
<div id="navigating-the-document" class="section level3">
<h3>Navigating the document</h3>
<p>Having defined sections in our document is nice because we can
quickly jump between them. There are 2 ways of quickly navigating
between sections: the <em>outline right bar</em> and the <em>bottom
outline menu</em>. If your right outline bar is collapsed, make sure to
click on the outline icon <img src="img/w3/Ia_OutlineIcon.png"
style="width:10.0%" /></p>
<p><img src="img/w3/Ia_Outline.png" style="width:50%" align="center"/></p>
<p>You will notice that the bottom outline has a few extra sections
labeled <em>Chunk</em>. A chunk refers to a piece of code in the
document. This piece of code will execute (unless you specify the
opposite) every time that you document renders. Each document is self
contained which means taht all the objects and functions you use must be
declared and loaded in order for the document to render properly (we
will talk more about this later).</p>
</div>
<div id="rendering-the-document" class="section level3">
<h3>Rendering the document</h3>
<p>Now that we have a document we are going to render it to different
formats. To render the document you can either click on the
<em>knit</em> icon <img src="img/w3/Ia_KnitIcon.png"
style="width:10.0%" />, or use the shortcut <code>ctrl+shift+k</code>.
The default format that the document will be rendered is html, but you
can choose different formats from the dropdown menu.</p>
<p><img src="img/w3/Ia_KnitMenu.png" style="width:35%" align="center"/></p>
<hr />
</div>
</div>
</div>
<div id="ii-getting-started" class="section level1">
<h1>II: Getting started</h1>
<div id="objects-in-r" class="section level2">
<h2>Objects in R</h2>
<p>R is an <a
href="https://en.wikipedia.org/wiki/Object-oriented_programming">object
oriented</a> programming environment, which means that we store the
information in variables called objects. To create a new object we use
the assign operator, <code>&lt;-</code> or <code>=</code>. For
example:</p>
<pre class="r"><code># we will create an object called &quot;num&quot; that contains the value 10
num &lt;- 10</code></pre>
<p>When creating an object, we will not see any outputs. If we want to
see what is inside an object, we have to print the object by typing it
on the console.</p>
<pre class="r"><code># This will print the information stored in the object
num</code></pre>
<pre><code>## [1] 10</code></pre>
</div>
<div id="storing-multiple-elements" class="section level2">
<h2>Storing multiple elements</h2>
<p>We can store more than one element inside an object. This can be
arranged in multiple structures. The most simple is a <em>vector</em> of
values. For example:</p>
<pre class="r"><code># Store multiple elements inside a vector
numbers &lt;- c(10, 40, 25, 3)

# Examine the result
numbers</code></pre>
<pre><code>## [1] 10 40 25  3</code></pre>
<!-- There are multiple ways of storing information inside objects, another way is using lists. Lists are more flexible than vectors since we can store different type of information. For example, in the next chunk of code, we will store information in the way of a numeric value and a string of characters: -->
<!-- ```{r lists} -->
<!-- values <- list(3, "five", 9, "10") -->
<!-- # print the list we just created -->
<!-- values -->
<!-- ``` -->
</div>
<div id="subsetting-objects" class="section level2">
<h2>Subsetting objects</h2>
<p>We can select specific elements inside our objects. For this we can
use indexing by position and use the operatoors <code>[ ]</code>. For
example:</p>
<pre class="r"><code># We can ask for the third element of our object values
numbers[3]</code></pre>
<pre><code>## [1] 25</code></pre>
</div>
<div id="boolean-logic" class="section level2">
<h2>Boolean logic</h2>
<p>Other important concept in programming is Boolean logic. Boolean
logic is a conditional statement with two possible outcomes:
<code>TRUE</code> or <code>FALSE</code>, this is used a lot for
decisions and controlling the flow of a program. The basic operators we
use for this in R are:</p>
<ul>
<li>Equal to (<code>==</code>)</li>
<li>And (<code>&amp;</code>)</li>
<li>Or (<code>|</code>)</li>
<li>Not (<code>!</code>)</li>
<li>greater (<code>&gt;</code>) or less (<code>&lt;</code>) than</li>
</ul>
<p>This operators can be combined. For example, if we want to make a
statement about a variable <code>x</code> not equals to variable
<code>y</code>, we can us the operator <code>!=</code> to define the
statement. In the following example we compare the 2 values to evaluate
if they are the same:</p>
<pre class="r"><code>test &lt;- numbers[1] == numbers[2]

test</code></pre>
<pre><code>## [1] FALSE</code></pre>
</div>
<div id="functions" class="section level2">
<h2>Functions</h2>
<p>R has a lot of base functions, but we can define new functions. When
using R studio, the key <em>Tab</em> will help us to auto complete, this
can help us a lot when we don’t remember the exact name of the functions
available. The best part of programming with R is that it has a very
active community. Since its open source, anyone can create functions and
compile them in a package (or library). we can download these packages
and access new functions.<br />
Functions in R require arguments, which we can see in the function
documentation or if we press the key <em>Tab</em> when we are inside the
function.</p>
<pre class="r"><code># To get the sum of a vector of numbers inside an object we use sum()
sum(numbers)</code></pre>
<pre><code>## [1] 78</code></pre>
<p>We can put functions inside function, for example, to get <span
class="math inline">\(\sqrt{\sum_1^n x}\)</span> the square root of a
sum of the numbers in x we can use:</p>
<pre class="r"><code>sqrt(sum(numbers))</code></pre>
<pre><code>## [1] 8.831761</code></pre>
<p>You can find the documentation regarding the functions, including the
arguments (expected inputs) and outputs generated, typing in the R
console the operator <code>?</code> followed by the name of the
function.</p>
</div>
<div id="introducing-the-pipes" class="section level2">
<h2>Introducing the pipes</h2>
<p>The library <code>dplyr</code> has several functions that can help to
clean, create new variables, and modify our data in other ways.</p>
<pre class="r"><code># if we dont have installed the library we will need to install it using:
# install.packages(&quot;dplyr&quot;)
# we load the library:
library(dplyr)</code></pre>
<p><code>dplyr</code> introduces a new operator called <em>pipes</em>
(<code>%&gt;%</code>), which can connect several functions to an object.
This is an alternative to write several functions in a single “line of
code” in a more organized way. For example, if we want to execute a
function <code>F1()</code> followed by another function
<code>F2()</code> for the object <code>x</code>:</p>
<p><code>F2(F1(x))</code> is equivalent to
<code>x %&gt;% F1() %&gt;% F2()</code></p>
<p>As you can notice, to read the code <code>F2(F1(x))</code> we have to
go from the inside to the outside to see the order of execution of the
functions, but when we read <code>x %&gt;% F1() %&gt;% F2()</code> we
read from left to right, which is the same way we normally would read
any text in western language.</p>
<p><strong>Suggestion:</strong> we can use the keys <em>Ctrl</em> +
<em>shift</em> + <em>m</em> to insert the <code>%&gt;%</code>
operator.</p>
<pre class="r"><code># We previously used this code to calculate the square root of the sum of x
sqrt(sum(numbers))</code></pre>
<pre><code>## [1] 8.831761</code></pre>
<p>Using the pipes we can do the same more organized, by writing the
order of execution from left to right.</p>
<pre class="r"><code>numbers %&gt;% # First we call the data
  sum() %&gt;% # Sum all the values
  sqrt() # Compute the square root</code></pre>
<pre><code>## [1] 8.831761</code></pre>
<p>You will notice that the outputs are exactly the same. Feel free to
use whatever syntax you prefer, but for this course we will use mostly
the pipes and writing the code from left to right.</p>
<hr />
</div>
</div>
<div id="iii-data-manipulation" class="section level1">
<h1>III: Data manipulation</h1>
<p>Now we will import some data into R, here is where the project
organization becomes handy… To import the data into R we need to know
the location in our computer, and specify the <em>path</em> to the file.
For example, I have the file located in a directory called data.</p>
<pre class="r"><code># Import the data
dat &lt;- read.csv(file = &quot;data/dataTb.csv&quot;)

# With the function head() we can see the first n observations of our data.frame
head(x = dat, n = 5)</code></pre>
<pre><code>##   ID_farm       Mun     Com Census Prev Incid    Xcoor   Ycoor Type MOV_year
## 1       1 GUADALMEZ ALMADEN     14 1.04     1 325389.1 4289645 BEEF     0.00
## 2       2 GUADALMEZ ALMADEN    200 0.00     0 327652.2 4291586 BEEF     3.00
## 3       3 GUADALMEZ ALMADEN     38 0.00     0 329353.2 4294230 BEEF     0.50
## 4       4 GUADALMEZ ALMADEN     70 0.00     0 328481.2 4287725 BEEF     0.83
## 5       5 GUADALMEZ ALMADEN     95 0.56     1 326659.1 4286466 BEEF     0.50
##   MOV_cen ANIM_mov goat sheep pig MEANfenced
## 1    0.00        0    0     0   0          0
## 2    1.50      119    0     0   0          0
## 3    1.33       14    0     0   0          0
## 4    1.20        5    0     1   0          0
## 5    0.53       26    0     1   0          0</code></pre>
<div id="examining-the-data" class="section level2">
<h2>Examining the data</h2>
<p>We can examine the structure of our data with the function
<code>str()</code>. This will show us the dimensions of our table, the
name of the variables, type and the first values for each column.</p>
<pre class="r"><code>str(dat)</code></pre>
<pre><code>## &#39;data.frame&#39;:    766 obs. of  16 variables:
##  $ ID_farm   : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Mun       : chr  &quot;GUADALMEZ&quot; &quot;GUADALMEZ&quot; &quot;GUADALMEZ&quot; &quot;GUADALMEZ&quot; ...
##  $ Com       : chr  &quot;ALMADEN&quot; &quot;ALMADEN&quot; &quot;ALMADEN&quot; &quot;ALMADEN&quot; ...
##  $ Census    : int  14 200 38 70 95 19 115 150 137 84 ...
##  $ Prev      : num  1.04 0 0 0 0.56 0 0 0 0.77 0 ...
##  $ Incid     : int  1 0 0 0 1 0 0 0 0 0 ...
##  $ Xcoor     : num  325389 327652 329353 328481 326659 ...
##  $ Ycoor     : num  4289645 4291586 4294230 4287725 4286466 ...
##  $ Type      : chr  &quot;BEEF&quot; &quot;BEEF&quot; &quot;BEEF&quot; &quot;BEEF&quot; ...
##  $ MOV_year  : num  0 3 0.5 0.83 0.5 1.33 0.83 0.33 0.17 0.33 ...
##  $ MOV_cen   : num  0 1.5 1.33 1.2 0.53 7.02 0.72 0.22 0.12 0.4 ...
##  $ ANIM_mov  : int  0 119 14 5 26 21 11 12 1 4 ...
##  $ goat      : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ sheep     : int  0 0 0 1 1 0 1 1 1 0 ...
##  $ pig       : int  0 0 0 0 0 0 0 0 0 0 ...
##  $ MEANfenced: num  0 0 0 0 0 0 0 0 0 0 ...</code></pre>
<p>We can subset specific rows and columns of our data. If you remember,
we previously used the operator <code>[]</code>. Since our object
containing the data is a data.frame and has named columns, we can use
the operator <code>$</code>, that is used to subset named elements of an
object. For example:</p>
<pre class="r"><code># Subset the first 5 observations of the col Mun
dat$Mun[1:5]</code></pre>
<pre><code>## [1] &quot;GUADALMEZ&quot; &quot;GUADALMEZ&quot; &quot;GUADALMEZ&quot; &quot;GUADALMEZ&quot; &quot;GUADALMEZ&quot;</code></pre>
<p>So far, we have used only base R to manipulate our data. In the next
section, we will use the library <code>dplyr</code>, which several
provides functions for data manipulation.</p>
</div>
<div id="data-reduction" class="section level2">
<h2>Data reduction</h2>
<div id="subsetting-columns" class="section level3">
<h3>Subsetting columns</h3>
<p>The function <code>select()</code> can be used to pick variables
based on their names. For example</p>
<pre class="r"><code># Here we select only the variables Mun, Census, and Prev
dat %&gt;% # This is the name of out table
  select(Mun, Census, Prev) # we define the columns we want</code></pre>
<pre><code>##         Mun Census Prev
## 1 GUADALMEZ     14 1.04
## 2 GUADALMEZ    200 0.00
## 3 GUADALMEZ     38 0.00
## 4 GUADALMEZ     70 0.00
## 5 GUADALMEZ     95 0.56
## 6 GUADALMEZ     19 0.00</code></pre>
</div>
<div id="subsetting-rows" class="section level3">
<h3>Subsetting rows</h3>
<p>dplyr has two main functions to subset rows: <code>slice()</code> and
<code>filter()</code>. <code>slice()</code> will subset the rows based
on their index. For example, if we want the rows 1 to 10:</p>
<pre class="r"><code>dat %&gt;% 
  slice(1:10)</code></pre>
<pre><code>##    ID_farm       Mun     Com Census Prev Incid    Xcoor   Ycoor Type MOV_year
## 1        1 GUADALMEZ ALMADEN     14 1.04     1 325389.1 4289645 BEEF     0.00
## 2        2 GUADALMEZ ALMADEN    200 0.00     0 327652.2 4291586 BEEF     3.00
## 3        3 GUADALMEZ ALMADEN     38 0.00     0 329353.2 4294230 BEEF     0.50
## 4        4 GUADALMEZ ALMADEN     70 0.00     0 328481.2 4287725 BEEF     0.83
## 5        5 GUADALMEZ ALMADEN     95 0.56     1 326659.1 4286466 BEEF     0.50
## 6        6 GUADALMEZ ALMADEN     19 0.00     0 327837.3 4289723 BEEF     1.33
## 7        7 GUADALMEZ ALMADEN    115 0.00     0 328840.3 4289479 BEEF     0.83
## 8        8 GUADALMEZ ALMADEN    150 0.00     0 332923.8 4288009 BEEF     0.33
## 9        9   CHILLON ALMADEN    137 0.77     0 332801.4 4302796 BEEF     0.17
## 10      10     AGUDO ALMADEN     84 0.00     0 334418.9 4318039 BEEF     0.33
##    MOV_cen ANIM_mov goat sheep pig MEANfenced
## 1     0.00        0    0     0   0          0
## 2     1.50      119    0     0   0          0
## 3     1.33       14    0     0   0          0
## 4     1.20        5    0     1   0          0
## 5     0.53       26    0     1   0          0
## 6     7.02       21    0     0   0          0
## 7     0.72       11    0     1   0          0
## 8     0.22       12    0     1   0          0
## 9     0.12        1    0     1   0          0
## 10    0.40        4    0     0   0          0</code></pre>
<p>Since the rows are not named, we use their indices, which is not very
useful.</p>
<p>A more useful way to select rows, would be based on conditions, for
this we can use our previous knowledge on boolean logic. For example, if
we want to create a subset of all the beef farms we use:</p>
<pre class="r"><code>beefFarms &lt;- dat %&gt;% 
  filter(Type == &quot;BEEF&quot;)

head(beefFarms)</code></pre>
<pre><code>##   ID_farm       Mun     Com Census Prev Incid    Xcoor   Ycoor Type MOV_year
## 1       1 GUADALMEZ ALMADEN     14 1.04     1 325389.1 4289645 BEEF     0.00
## 2       2 GUADALMEZ ALMADEN    200 0.00     0 327652.2 4291586 BEEF     3.00
## 3       3 GUADALMEZ ALMADEN     38 0.00     0 329353.2 4294230 BEEF     0.50
## 4       4 GUADALMEZ ALMADEN     70 0.00     0 328481.2 4287725 BEEF     0.83
## 5       5 GUADALMEZ ALMADEN     95 0.56     1 326659.1 4286466 BEEF     0.50
## 6       6 GUADALMEZ ALMADEN     19 0.00     0 327837.3 4289723 BEEF     1.33
##   MOV_cen ANIM_mov goat sheep pig MEANfenced
## 1    0.00        0    0     0   0          0
## 2    1.50      119    0     0   0          0
## 3    1.33       14    0     0   0          0
## 4    1.20        5    0     1   0          0
## 5    0.53       26    0     1   0          0
## 6    7.02       21    0     0   0          0</code></pre>
</div>
</div>
<div id="creating-new-variables" class="section level2">
<h2>Creating new variables</h2>
<p>Often times we will need to create new variables based on the
information we have. In the following example, we will use the function
<code>mutate()</code> to create a new categorical variable for the size
of the farm based on the census recorded. Notice that we use the
function <code>cut()</code> to create the</p>
<pre class="r"><code># Create new variable for farm size
dat &lt;- dat %&gt;% # this is the data used
  mutate( # We use the function mutate for creating new variables
    # We will use the function cut() for categorization
    farmSize = cut(
      Census, # Name of the variable used for categorization
      breaks = c(0, 50, 200, 10e3), # Breaks used to create the categories
      labels = c(&quot;small&quot;, &quot;medium&quot;, &quot;large&quot;) # Names for each of the categories
    )
  )

# print the first observations
head(dat) </code></pre>
<pre><code>##   ID_farm       Mun     Com Census Prev Incid    Xcoor   Ycoor Type MOV_year
## 1       1 GUADALMEZ ALMADEN     14 1.04     1 325389.1 4289645 BEEF     0.00
## 2       2 GUADALMEZ ALMADEN    200 0.00     0 327652.2 4291586 BEEF     3.00
## 3       3 GUADALMEZ ALMADEN     38 0.00     0 329353.2 4294230 BEEF     0.50
## 4       4 GUADALMEZ ALMADEN     70 0.00     0 328481.2 4287725 BEEF     0.83
## 5       5 GUADALMEZ ALMADEN     95 0.56     1 326659.1 4286466 BEEF     0.50
## 6       6 GUADALMEZ ALMADEN     19 0.00     0 327837.3 4289723 BEEF     1.33
##   MOV_cen ANIM_mov goat sheep pig MEANfenced farmSize
## 1    0.00        0    0     0   0          0    small
## 2    1.50      119    0     0   0          0   medium
## 3    1.33       14    0     0   0          0    small
## 4    1.20        5    0     1   0          0   medium
## 5    0.53       26    0     1   0          0   medium
## 6    7.02       21    0     0   0          0    small</code></pre>
</div>
<div id="summarizing-the-data" class="section level2">
<h2>Summarizing the data</h2>
<div id="number-of-observations" class="section level3">
<h3>Number of observations</h3>
<p>There are multiple ways to obtain summaries by groups in R. The most
basic is counting the number of observations for each category of a
variable. For example, we use the function <code>count()</code> to count
the number of farms for each of the categories we just created:</p>
<pre class="r"><code>dat %&gt;% 
  count(farmSize)</code></pre>
<pre><code>##   farmSize   n
## 1    small 300
## 2   medium 367
## 3    large  99</code></pre>
<p>We can add multiple variables to count the number of observations for
each of the combinations between levels. For example:</p>
<pre class="r"><code>dat %&gt;% 
  count(farmSize, Type)</code></pre>
<pre><code>##   farmSize  Type   n
## 1    small  BEEF 241
## 2    small DAIRY  59
## 3   medium  BEEF 346
## 4   medium DAIRY  21
## 5    large  BEEF  96
## 6    large DAIRY   3</code></pre>
</div>
<div id="other-summary-statistics" class="section level3">
<h3>Other summary statistics</h3>
<p>We can also compute other summary statistics such as median, mean,
standard deviation, or any other function in R. For example:</p>
<pre class="r"><code>dat %&gt;% 
  group_by(farmSize) %&gt;% # We group by farm size
  # we use the function summarise to get the summary statistics
  summarise(
    count = n(), # we use the function n() to get the counts
    medianPrev = median(Prev), # mean() to get the mean 
    maxPrev = max(Prev) # sd() for the standard deviation
  )</code></pre>
<pre><code>## # A tibble: 3 × 4
##   farmSize count medianPrev maxPrev
##   &lt;fct&gt;    &lt;int&gt;      &lt;dbl&gt;   &lt;dbl&gt;
## 1 small      300          0    16.7
## 2 medium     367          0    14.2
## 3 large       99          0    12.4</code></pre>
<p>The functions <code>mutate</code> and <code>summarise</code> in
<code>dplyr</code> have some variants that allow to do multiple
operation for multiple variables, which makes the manipulation more
flexible. For example if we want to calculate the standard deviation and
mean for multiple variables, we can use:</p>
<pre class="r"><code>dat %&gt;% 
  group_by(farmSize) %&gt;% 
  summarise_at( # Notice that we use the function `summarise_at()` this time
    vars(Prev, ANIM_mov),  # first we specify the names of the columns
    list(median = ~median(.), max_value = ~max(.), count = ~n()) # Then we specify the functions we want to use
  )</code></pre>
<pre><code>## # A tibble: 3 × 7
##   farmSize Prev_median ANIM_mov_median Prev_max_value ANIM_mov_max_value
##   &lt;fct&gt;          &lt;dbl&gt;           &lt;dbl&gt;          &lt;dbl&gt;              &lt;int&gt;
## 1 small              0               2           16.7                556
## 2 medium             0               9           14.2                586
## 3 large              0              21           12.4               1154
## # ℹ 2 more variables: Prev_count &lt;int&gt;, ANIM_mov_count &lt;int&gt;</code></pre>
</div>
</div>
</div>
<div id="iv-a-glimpse-into-data-visualization" class="section level1">
<h1>IV: A glimpse into data visualization</h1>
<p>To finalize this lab, we will do a little glimpse into data
visualization. For today we will keep it simple and just use the base R
functions.</p>
<p>The choice of which type of figure we will use will depend on the
type of variables we are using.</p>
<p>For example, to visualize continuous distributions we can use a
histogram</p>
<pre class="r"><code>hist(dat$Prev)</code></pre>
<p><img src="lab3_files/figure-html/hist-1.png" width="672" /></p>
<p>If we want to plot two continuous variables we can use a scatter
plot:</p>
<pre class="r"><code>plot(dat$Census, dat$Prev)</code></pre>
<p><img src="lab3_files/figure-html/scatterplot-1.png" width="672" /></p>
<p>If we want to visualize the relationship between a categoricla and a
continous variable we can use a boxplot:</p>
<pre class="r"><code>boxplot(dat$Prev~dat$farmSize)</code></pre>
<p><img src="lab3_files/figure-html/boxplot-1.png" width="672" /></p>
<p>Next week we will go more in detail into how to make our figures
pretty ✨</p>
<hr />
</div>
<div id="questions" class="section level1">
<h1>QUESTIONS</h1>
<p>Render the document using the Rmd engine and submit your responses as
a word document or pdf. <strong>DO NOT SUBMIT IT AS A HTML or
Rmd.</strong></p>
<ol style="list-style-type: decimal">
<li><p>How many rows and columns do you have in the dataset
“dataTB.csv”? Using R, provide a table displaying the information
contained in the 10 first rows of the six first columns.</p></li>
<li><p>Provide a table of the beef farms where the number of movements
are more than 500, only including the columns: <em>ID_farm</em>,
<em>Mun</em>, <em>Com</em>, <em>Census</em> and
<em>ANIM_mov</em></p></li>
<li><p>Provide a table summarizing the count, median, and maximum values
of the TB prevalence by county (Com)</p></li>
<li><p>Bonus: Create a boxplot displaying the TB prevalence by
county.</p></li>
</ol>
<hr />
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
